<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="x-ua-compatible" content="IE=edge;chrome=1">
    <meta name="author" content="zhaozebin@gridsum.com">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <title>测试</title>
</head>
<body>
<button type="button" id="payBtn">支付测试</button>
<div>
    <label for="apiKey">API Key</label>
    <input type="text" id="apiKey">
    <button id="checkBtn">check API</button>
    <textarea id="winText" cols="30" rows="15">

    </textarea>
</div>
<script src="scripts/jquery-2.1.4.min.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
    var isWeixin = /MicroMessenger/.test(navigator.userAgent);

    document.getElementById("payBtn").onclick = function () {
        alert('payBtn')
    };

    function getCode() {
        var queryObj = {};
        var queryString = location.search.slice(1);
        var aQuery = queryString.split('&');
        for (var i = 0; i < aQuery.length; i++) {
            var item = aQuery[i].split('=');
            queryObj[item[0]] = item[1] || '';
        }

        return queryObj;
    }
    //var urlWidthSearch = location.href.split("#")[0];
    //var paramLocation = urlWidthSearch.split('?')[0] + ":80?" + urlWidthSearch.split('?')[1];

    (function () {
        var jsApiConfigDeferred = $.ajax({
            url: "http://tianjunmedia.com/beehive/microsite/user/getjsapiconfig",
            type: "POST",
            dataType: 'JSON',
            data: {
                sig: "DBE8317A0D713425B738C762D1639492",
                url: encodeURIComponent(location.href.split("#")[0])
            }
        });
        //"http://tianjunmedia.com:80/beehive/test2.html" + location.search
        jsApiConfigDeferred.done(function (res) {
            var config = res.data;
            document.getElementById('winText').innerHTML = "url: " + location.href + " | data: " + JSON.stringify(res.data);
            var wxConfig = {
                debug: true,
                appId: config.appId,
                timeStamp: parseInt(config.timestamp),
                nonceStr: config.nonceStr,
                signature: config.signature,
                jsApiList: ['getBrandWCPayRequest']
            };
            //location.href.split("#")[0]

            //alert('sig: ' + config.signature);
            wx.config(wxConfig);
            //var begin = new Date();
            //alert("http://tianjunmedia.com:80/beehive/test2.html" + location.search);

            wx.ready(function () {
                alert('ready');
                // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。
            });
            //var end = new Date();
            //alert('time: ' + (end - begin));
            /*wx.ready(function () {
             alert(1);
             document.getElementById('checkBtn').onclick = function () {
             jsApiConfigDeferred.done(function (res) {
             var config = res.data;
             wx.invoke('getBrandWCPayRequest', {
             "appId": config.appId,     //公众号名称，由商户传入
             "timeStamp": config.timeStamp,         //时间戳，自1970年以来的秒数
             "nonceStr": config.nonceStr, //随机串
             "package": "prepay_id=u802345jgfjsdfgsdg888",
             "signType": "MD5",         //微信签名方式:
             "paySign": config.sgnature //微信签名
             }, function (res) {
             alert(res);
             })
             })
             }
             });*/
            /*wx.error(function (e) {
             alert(JSON.stringify(e));
             })*/
        });
    }())
</script>
</body>
</html>